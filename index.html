<html>
<head>
  <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
</head>
<body>

<h1> Bragging Rights </h1>

<p class="sans">
What North American city has won the most major sports championships?
</p>


<div id="brGrid"></div>

<script type='module'>

  import { Grid, html } from "https://unpkg.com/gridjs?module";

  import brCities from './data/brCities.js'
  import brTeams from './data/brTeams.js'
  import brMLB from './data/brMLB.js'
  import brNFL from './data/brNFL.js'
  import brNBA from './data/brNBA.js'
  import brNHL from './data/brNHL.js'

  const updateCityItem = (o, c, ck, k ) => {
    o[c] = (c in mc) ? o[c] : {} 
    o[c][ck] = (ck in o[c]) ? o[c][ck]+1 : 1
    o[c][k] = (k in o[c]) ? o[c][k]+1 : 1
  }
  const N = (a,c,k) => (k in a[c]) ? a[c][k] : 0
  const cRow = (a,c) => ( [ c, N(a,c,'cWins'), N(a,c,'cLosses'), 
                               N(a,c,'mlbWins'), N(a,c,'mlbLosses'),
                               N(a,c,'nflWins'), N(a,c,'nflLosses'),
                               N(a,c,'nbaWins'), N(a,c,'nbaLosses'),
                               N(a,c,'nhlWins'), N(a,c,'nhlLosses')
                          ])

  // read through the sports data and add up wins/losses
  const mc = {}
  brMLB.forEach( y => {
    updateCityItem( mc, brTeams[y.winner], 'cWins', 'mlbWins' )
    updateCityItem( mc, brTeams[y.loser], 'cLosses', 'mlbLosses' )
  })
  brNFL.forEach( y => {
    updateCityItem( mc, brTeams[y.winner], 'cWins', 'nflWins' )
    updateCityItem( mc, brTeams[y.loser], 'cLosses', 'nflLosses' )
  })
  brNBA.forEach( y => {
    updateCityItem( mc, brTeams[y.winner], 'cWins', 'nbaWins' )
    updateCityItem( mc, brTeams[y.loser], 'cLosses', 'nbaLosses' )
  })
  brNHL.forEach( y => {
    updateCityItem( mc, brTeams[y.winner], 'cWins', 'nhlWins' )
    updateCityItem( mc, brTeams[y.loser], 'cLosses', 'nhlLosses' )
  })
  console.dir(mc)

  // convert to array format (see cRow() func) for the grid
  const sortedCities = Object.keys(mc).sort()
  const mcArray = sortedCities.reduce( (a,c) => (a.push(cRow(mc,c)), a), [] )
  console.dir(mcArray)
  

  const brGrid = new Grid({
    columns:  [ 'City', 
               { name: 'Championships',
                 columns: [ { name: 'wins', id: 'c-w' }, { name: 'losses', id: 'c-l' } ]
                },
               { name: 'MLB',
                 columns: [ { name: 'wins', id: 'm-w' }, { name: 'losses', id: 'm-l' } ]
                },
               { name: 'NFL',
                 columns: [ { name: 'wins', id: 'f-w'}, { name: 'losses', id: 'f-l' } ]
                },
               { name: 'NBA',
                 columns: [ { name: 'wins', id: 'b-w'}, { name: 'losses', id: 'b-l' } ]
                },
               { name: 'NHL',
                 columns: [ { name: 'wins', id: 'h-w'}, { name: 'losses', id: 'h-l' } ]
                },
              ],
    sort: true,
    data: mcArray
  }).render(document.getElementById("brGrid"));


  const cellPopup = (args) => {
    //console.log('cell: ' + JSON.stringify(args), args));
    //console.log(args,args[3]['_cells'][0].data,args[2].id)
    if (args[2].id == 'city') {
      console.log(`popup city stats for ${args[3]['_cells'][0].data}`)
    } else if (args[2].id[1] == '-') {
      console.log(`popup list of stats for ${args[3]['_cells'][0].data} ${args[2].id}`)
    }
  }
  
  brGrid.on('cellClick', (...args) => cellPopup(args))


</script>
</body>
</html>
